<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bouncing Ball Effect on Canvas</title>
</head>
<body>
<script>

// 초기화
let init = false;
let myCanvas;
let Context;

// 공의 개수
const ball_max = 13;
const balls = Array();
const ball_image = new Image();

// 초기화
function Init() {
    if (init == false) {
        myCanvas = document.getElementById("MyCanvas");
        Context = myCanvas.getContext("2d");
        ball_image.src = "https://img.favpng.com/7/13/4/volleyball-scalable-vector-graphics-sport-icon-png-favpng-L0m1jF1tq1HtDPzeay8XfyyzQ_t.jpg";
        ball_image.width = 32;
        ball_image.height = 32;

        for (let i = 0; i < ball_max; ++i) {
            const obj = new Object();
            obj.x = Math.random() * myCanvas.width;
            obj.y = Math.random() * myCanvas.height;
            obj.size = Math.random() * 32 + 16; // 공의 크기를 정한다. 최소 16 ~ 48까지의 크기를 위해 최솟값 16을 더한다. 
            obj.xdir = Math.random() * 16 + 3; // x 방향으로의 이동량, 3 ~ 19 범위
            obj.ydir = Math.random() * 16 + 3; // y 방향으로의 이동량 , 3 ~ 19 범위
            balls.push(obj);
        }
        init = true;
    }
}


function Run() {
    for (let i = 0; i < ball_max; ++i) {
        // 공의 x 좌표를 x방향 벡터만큼 이동한다.
        balls[i].x += balls[i].xdir;

        // 공이 왼쪽 경계를 넘은 경우
        if (balls[i].x < balls[i].size / 2) {
            balls[i].x = balls[i].size / 2; // 왼쪽 경계에 붙이고, 
            balls[i].xdir = -balls[i].xdir; // 다음 번 이동방향을 전환하기 위해 음수로 바꿔준다. 
        }
        
        // 공이 오른쪽 경계를 넘은 경우
        if (balls[i].x > myCanvas.width - balls[i].size / 2) {
            balls[i].x = myCanvas.width - balls[i].size / 2; // 오른쪽 경계에 붙이고, 
            balls[i].xdir = -balls[i].xdir; // 다음 번 이동 방향을 반대로 해준다. 
        }
        // 공의 y 좌표를 ydir 방향만큼 
        balls[i].y += balls[i].ydir;

        if (balls[i].y < balls[i].size / 2) {
            balls[i].y = balls[i].size / 2;
            balls[i].ydir = -balls[i].ydir;
        }

        if (balls[i].y > myCanvas.height - balls[i].size / 2) {
            balls[i].y = myCanvas.height - balls[i].size / 2;
            balls[i].ydir = -balls[i].ydir;
        }
    }
    onDraw()
}

function onDraw() {
    if (init == false) return;
    Context.strokeStyle = "#000";
    Context.lineWidth = 1;
    Context.strokeRect(0, 0, myCanvas.width - 1, myCanvas.height - 1);
    Context.fillStyle = "#fcfcfc";
    Context.fillRect(1, 1, myCanvas.width - 2, myCanvas.height - 2);

    // 캔버스는 공 이미지의 왼쪽 상단 좌표를 기준으로 그리므로, 중심 좌표를 기준으로 그리기 위해서는,
    for (let i = 0; i < ball_max; ++i) {
        Context.drawImage(ball_image,
            balls[i].x - balls[i].size / 2, // 공의 x좌표에서 공의 크기 절반만큼을 뺀 x좌표
            balls[i].y - balls[i].size / 2, // 공의 y좌표에서 공의 크기 절반만큼을 뺀 y 좌표
            balls[i].size, // x 크기
            balls[i].size // y 크기
        );
    }
    Context.filter = "None";
}
document.addEventListener('DOMContentLoaded', () => {
    Init();
    setInterval(Run, 20);
})

</script>
<canvas id="MyCanvas" width=800 height="600">Canvas is not supported yet</canvas>
</body>
</html>